<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="assets/js/cordova.js"></script>
	<link rel="stylesheet" href="assets/css/style.css">
	<link rel="stylesheet" href="assets/css/jquery.mobile-1.3.0.min.css" />
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/jquery.mobile-1.3.0.min.js"></script>
		<script>
		document.addEventListener("backbutton", backKeyDown, true); 
		function backKeyDown() { 
			  e.preventDefault();

		}	

        $( "#popupPanel" ).on({
        	popupbeforeposition: function() {
        		var h = $( window ).height();
        		$( "#popupPanel" ).css( "height", h );
        	}
        });
        
		$(document).live('pageinit',function(){
	  $(document).ready(function(){
			$.ajax({
					  url: 'http://robincosamas.com/json4phonegap/call_menu.php?id_category=1',
					  beforeSend : function() {$.mobile.showPageLoadingMsg("a", "Loading....");},
					  complete   : function() {$.mobile.hidePageLoadingMsg();},
					  dataType: 'jsonp',
					  jsonp: 'jsoncallback',
					  success: function(data, status){
						  
						  $.each(data, function(i,item){
							
							  $(".alist").append("<li data-corners='false' data-shadow='false' data-iconshadow='true' data-wrapperels='div' data-icon='arrow-r' data-iconpos='right' data-theme='c' class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-thumb ui-btn-up-c'><div class='ui-btn-inner ui-li'><div class='ui-btn-text'><a href='#' class='ui-link-inherit'><img class='ui-li-thumb' src='img/kombo/kombo (5).jpg'><h3 class='ui-li-heading'>"+item.nama_menu+"</h3><p class='ui-li-desc'>"+item.harga+"</p></a></div><span class='ui-icon ui-icon-arrow-r ui-icon-shadow'>&nbsp;</span></div></li>");
						 	
						  });
					  },
					  error: function(){
						alert('Error Occur');
					  }
				});
		  });
	  $(document).ready(function(){
			$.ajax({
					  url: 'http://robincosamas.com/json4phonegap/call_menu.php?id_category=2',
					  beforeSend : function() {$.mobile.showPageLoadingMsg("a", "Loading....");},
					  complete   : function() {$.mobile.hidePageLoadingMsg();},
					  dataType: 'jsonp',
					  jsonp: 'jsoncallback',
					  success: function(data, status){
						  
						  $.each(data, function(i,item){
							
							  $(".blist").append("<li data-corners='false' data-shadow='false' data-iconshadow='true' data-wrapperels='div' data-icon='arrow-r' data-iconpos='right' data-theme='c' class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-thumb ui-btn-up-c'><div class='ui-btn-inner ui-li'><div class='ui-btn-text'><a href='#' class='ui-link-inherit'><img class='ui-li-thumb' src='img/kombo/kombo (5).jpg'><h3 class='ui-li-heading'>"+item.nama_menu+"</h3><p class='ui-li-desc'>"+item.harga+"</p></a></div><span class='ui-icon ui-icon-arrow-r ui-icon-shadow'>&nbsp;</span></div></li>");
						 	
						  });
					  },
					  error: function(){
						alert('Error Occur');
					  }
				});
		  });
	  $(document).ready(function(){
			$.ajax({
					  url: 'http://robincosamas.com/json4phonegap/call_menu.php?id_category=3',
					  beforeSend : function() {$.mobile.showPageLoadingMsg("a", "Loading....");},
					  complete   : function() {$.mobile.hidePageLoadingMsg();},
					  dataType: 'jsonp',
					  jsonp: 'jsoncallback',
					  success: function(data, status){
						  
						  $.each(data, function(i,item){
							
							  $(".clist").append("<li data-corners='false' data-shadow='false' data-iconshadow='true' data-wrapperels='div' data-icon='arrow-r' data-iconpos='right' data-theme='c' class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-thumb ui-btn-up-c'><div class='ui-btn-inner ui-li'><div class='ui-btn-text'><a href='#' class='ui-link-inherit'><img class='ui-li-thumb' src='img/kombo/kombo (5).jpg'><h3 class='ui-li-heading'>"+item.nama_menu+"</h3><p class='ui-li-desc'>"+item.harga+"</p></a></div><span class='ui-icon ui-icon-arrow-r ui-icon-shadow'>&nbsp;</span></div></li>");
						 	
						  });
					  },
					  error: function(){
						alert('Error Occur');
					  }
				});
		  });
	  $(document).ready(function(){
			$.ajax({
					  url: 'http://robincosamas.com/json4phonegap/call_menu.php?id_category=4',
					  beforeSend : function() {$.mobile.showPageLoadingMsg("a", "Loading....");},
					  complete   : function() {$.mobile.hidePageLoadingMsg();},
					  dataType: 'jsonp',
					  jsonp: 'jsoncallback',
					  success: function(data, status){
						  
						  $.each(data, function(i,item){
							
							  $(".dlist").append("<li data-corners='false' data-shadow='false' data-iconshadow='true' data-wrapperels='div' data-icon='arrow-r' data-iconpos='right' data-theme='c' class='ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-has-thumb ui-btn-up-c'><div class='ui-btn-inner ui-li'><div class='ui-btn-text'><a href='#' class='ui-link-inherit'><img class='ui-li-thumb' src='img/kombo/kombo (5).jpg'><h3 class='ui-li-heading'>"+item.nama_menu+"</h3><p class='ui-li-desc'>"+item.harga+"</p></a></div><span class='ui-icon ui-icon-arrow-r ui-icon-shadow'>&nbsp;</span></div></li>");
						 	
						  });
					  },
					  error: function(){
						alert('Error Occur');
					  }
				});
		  });
	});
		
	     // include this file before your jquery-mobile script tag
        $(document).delegate('.ui-navbar ul li > a', 'click', function() {
        	//search the navbar to deactivate the active button
        	$('ul.navigation li a').removeClass('ui-btn-active');

        	//change the active tab
        	$(this).addClass('ui-btn-active');

        	//hide the siblings
        	$('#' + $(this).attr('data-href')).show().siblings('.tab-content').hide();

        	return false;
        });

		</script>
</head>
<body>
 <div data-role="page">
	<div data-role="popup" id="popupPanel" data-corners="false" data-theme="none" data-shadow="false" data-tolerance="0,0">
		<a href="cart.html" data-theme="a" data-icon="cart" data-mini="true" data-role="button">Cart</a>
		<a href="#" data-theme="a" data-icon="star" data-mini="true" data-role="button">Favorites</a>
		<a href="#" data-theme="a" data-icon="gear" data-mini="true" data-role="button">Settings</a>
		<a href="#" data-theme="a" data-icon="back" data-mini="true" data-role="button">Sign Out</a>
	</div>
	<div data-role="header" data-theme="d" data-position="fixed" data-id="footer">
	<a href="index.html" data-role="button" data-icon="home" data-iconpos="notext" data-ajax="false">Home</a> 
	<h1>KFC Menus</h1>
	<a href="#popupPanel" data-rel="popup" data-transition="slide" data-position-to="window" data-role="button" data-icon="grid" data-iconpos="notext">Options</a>
		<div data-role="navbar">
			<input type="search" name="search" id="search-paket" value="" data-id="footer" />	
			<ul class="navigation">
				<li><a href="#" data-href="combo" class="ui-btn-active">Combo</a></li>
				<li><a href="#" data-href="foods">Foods</a></li>
				<li><a href="#" data-href="drinks">Drinks</a></li>
				<li><a href="#" data-href="deserts">Deserts</a></li>
			</ul>
		</div>
	</div>
	
	<div data-role="content" id="combo" class="tab-content first">
		<ul data-role="listview" data-split-icon="star" data-split-theme="d" class="alist">
			
		</ul>
	</div>
	
	<div data-role="content" id="foods" class="tab-content">
		<ul data-role="listview" class="blist">
		
	</div>
	
	<div data-role="content" id="drinks" class="tab-content">
		<ul data-role="listview" class="clist">
			
		</ul>
	</div>
	
	<div data-role="content" id="deserts" class="tab-content">
		<ul data-role="listview" class="dlist">
					</ul>
	</div>
	
</div>
</body>

<script type="text/javascript">
		var name = document.getElementById(".ul-li-heading");
		var price = document.getElementById(".ul-li-desc");
		
		var crt = new Array();
		var ins = new Array();
		var upd = new Array();
		var del = new Array();
		
		var table = "orderdetail";
		var selectAllStatement = "SELECT * FROM "+table; // dipakai dalam function showrec
		var dropStatement = "DROP TABLE "+table;
		var db = openDatabase("dborderaway", "1.0", "db order away",200000);
		var dataset;
		
		/* -------------------------------------- ORDER DETAIL ----------------------------------------------- */
		var crtOrderDetail = "CREATE TABLE IF NOT EXISTS orderdetail (iddetail INTEGER PRIMARY KEY AUTOINCREMENT, idmenu INTEGER, harga INTEGER, qty INTEGER)";
		var insOrderDetail = "INSERT INTO orderdetail (idmenu, harga, qty) VALUES (?, ?, ?)";
		var updOrderDetail = "UPDATE orderdetail SET idmenu = ?, harga=?, qty=? where idorder=? and iddetail=?";
		var delOrderDetail = "DELETE FROM orderdetail WHERE iddetail=?";
		crt[0] = crtOrderDetail; ins[0] = insOrderDetail; upd[0] = updOrderDetail; del[0] = delOrderDetail;
		
		crtTable();
		
		// function ini untuk d taro d cart
		//showRec();
		
		/* function yang paling awal dijalankan, bertujuan mengcreate table */
		function crtTable(){
			db.transaction(function(tx){tx.executeSql(crtOrderDetail);});
		}
		
		/* function yang digunakan untuk menyimpan data dalam table sementara */
		function insRec(name, price, qty){
			db.transaction(function(tx){tx.executeSql(insOrderDetail, [name, price, qty], loadAndReset, onError);});
			//console.log(name+" "+price+" "+qty);
		}
		/*function updRec(updTable){
			db.transaction(function(tx){tx.executeSql(updTable. [], loadAndReset, onError);});
		}
		function showRec(){
			results.innerHTML = '';
			db.transaction(function(tx){
				tx.executeSql(selectAllStatement, [], function(tx, result){
					dataset = result.rows;
					results.innerHTML = 
					'<tr><th>No</th><th>Qty</th><th>Menu</th><th>Price</th></tr>';
					for (var i = 0, item = null; i < dataset.length; i++) {
						item = dataset.item(i);
						results.innerHTML +=
						'<tr><td>' + (i+1) + '</td><td>' + item['qty'] + '</td><td id="event'+(i+1)+'" style="width:200px;"></td>'+
						'<td><a href="#" onclick="loadRec('+i+')">edit</a>  <a href="#" onclick="delRec('+item['iddetail']+')">delete</a></td></tr>';
						//theevent[i] = new Date(item['tgl']);
					}
				}
			});
		}*/
		
		
		function loadRec(i){
			var item = dataset.item(i);
			name.value = item['name'];
			price.value = item['price'];
			qty.value = item['qty'];
		}
		function delRec(id){
			db.transaction(function(tx){tx.executeSql(delOrderAway, [id], showRec, onError);});
			resetForm();
		}
		function dropTable(){
			db.transaction(function(tx){tx.executeSql(dropStatement, [], showRec, onError);});
		}
		function loadAndReset(){
			//resetForm();
			//showRec();
		}
		function resetForm(){
			name.value='';
			price.value='';
			qty.value='';
		}
		function onError(tx, error) {
			alert(error.message);
		}
	</script>

</html>